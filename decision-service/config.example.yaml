version: v1

server:
  listen: ":8080"
  read_timeout_ms: 5000
  write_timeout_ms: 5000

modes:
  enforce: true        # if false => Observe mode (always ALLOW; still logs & may issue clearance)
  fail_open: true      # if rate store fails and true => ALLOW
  under_attack: false  # if true => add +15 risk and lower thresholds by 10

cookie:
  name: "Clearance"
  domain: ""           # empty => no Domain attribute
  path: "/"
  max_age_sec: 21600   # 6h
  same_site: "Lax"     # Lax | None
  secure: true
  http_only: true

token:
  alg: "HS256"
  issuer: "fastgate"
  skew_sec: 30
  keys:
    v1: "c2VjcmV0LXNlY3JldC1zZWNyZXQtc2VjcmV0LXNlY3JldA"  # base64url secret (example only)
  current_kid: "v1"

policy:
  challenge_threshold: 60
  block_threshold: 85
  paths:
    - pattern: "^/login"
      base: 40
    - pattern: "^/api/"
      base: 25
    - pattern: "^/live"
      base: 35
  ip_rps_threshold: 20
  token_rps_threshold: 30
  ws_concurrency_limits:
    per_ip: 20
    per_token: 40

challenge:
  difficulty_bits: 16  # keep small for dev; raise in prod (e.g., 18-20)
  ttl_sec: 60
  max_retries: 2

logging:
  level: "info"

webauthn:
  enabled: true        # Set to true to enable WebAuthn/FIDO2 challenges
  rp_id: "localhost"   # Must match domain (no protocol, no port)
  rp_name: "FastGate"
  rp_origins:
    - "http://localhost:8088"
  ttl_sec: 60

threat_intel:
  enabled: true        # Set to true to enable federated threat intelligence
  cache_capacity: 50000  # Max indicators to store in memory

  # Peers to subscribe to (fetch indicators from)
  peers: []
    # Example peer configuration:
    # - name: "friend1"
    #   url: "https://fastgate.friend1.com"
    #   collection_id: "fastgate"
    #   username: "fastgate-peer"
    #   password: "shared-secret"
    #   poll_interval_sec: 30

  # Auto-publish local attacks to TAXII server
  auto_publish:
    enabled: true
    min_confidence: 70  # Only publish high-confidence blocks (score >= 70)
    ttl_hours: 1        # How long indicators remain valid

proxy:
  enabled: false       # Set to true to enable integrated reverse proxy mode
  mode: "integrated"   # "integrated" = single binary mode | "nginx" = traditional auth_request mode

  # Simple single-origin mode (for most use cases)
  origin: "http://localhost:3000"

  # Advanced: Multi-origin routing (comment out 'origin' above to use routes)
  # routes:
  #   # Host-based routing
  #   - host: "game.example.com"
  #     origin: "http://localhost:3000"
  #
  #   - host: "shop.example.com"
  #     origin: "http://localhost:4000"
  #
  #   # Path-based routing (regex patterns)
  #   - path: "^/api/"
  #     origin: "http://localhost:5000"
  #
  #   - path: "^/static/"
  #     origin: "http://cdn.example.com"

  # Challenge page path (where PoW/WebAuthn challenges are served)
  challenge_path: "/__uam"

  # Proxy timeouts (in milliseconds)
  timeout_ms: 30000       # 30 seconds
  idle_timeout_ms: 90000  # 90 seconds

  # Connection pool settings (tune for heavy-duty deployments)
  max_idle_conns: 100           # Max idle connections across all hosts (default: 100)
  max_idle_conns_per_host: 20   # Max idle connections per host (default: 20)
  max_conns_per_host: 100       # Max connections per host (default: 100, increase for high traffic)
